{{ ansible_managed | comment }}
ext_if="{{ ext_if }}"

set block-policy return
set skip on lo0

match in all scrub (no-df random-id max-mss 1440)
block in all
block return

antispoof log for $ext_if

pass in on $ext_if proto icmp all
pass in on $ext_if proto icmp6 all

# NTP access
pass out on $ext_if proto {tcp, udp} to any port ntp

# SSH access
pass out on $ext_if proto tcp to any port ssh
pass in on $ext_if proto tcp from any to any port ssh flags S/SA synproxy state

# DNS access
pass out on $ext_if proto {tcp, udp} to any port domain
{% if inventory_hostname in groups['dnsservers'] %}
pass in on $ext_if proto {tcp, udp} from any to any port domain
{% endif %}

# SMTP access
pass out on $ext_if proto tcp to any port smtp

# HTTP access
pass out on $ext_if proto tcp to any port {http, https}
